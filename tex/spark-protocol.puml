@startuml

'define icons
control Driver
participant "Job Committer"
control Executor
participant "Task Committer"
participant Operation

' protocol
'== Initialization ==

Driver -> "Job Committer": setupJob()

== For Each Task Attempt ==
Driver -> Executor: execute work
Executor -> "Task Committer": setupTask()
Executor --> Operation: execute
Executor <-- Operation: finished

Executor -> Driver: can commit?
Executor <-- Driver:  <commit | abort>

alt commit
  Executor -> "Task Committer": needsTaskCommit()?
  Executor <-- "Task Committer": <true | false>
    alt needs task commit
    Executor -> Driver: commitPending
    Executor -> "Task Committer": commitTask()
    Executor <-- "Task Committer": committed task
    end

else abort
  Executor -> "Task Committer": abortTask()
  Executor <-- "Task Committer": aborted task
end
Executor -> Driver : done

alt done-not-received-in time interval
  Driver -> "Job Committer": cleanupTask()
  Driver -> Driver: reschedule task
end


== Job Commit==


Driver -> "Job Committer": commitJob()
Driver <-- "Job Committer": committed job
Driver -> "Job Committer": cleanupJob()


@enduml
